#include "editlokos.h"
#include "ui_editlokos.h"

#include "../loko.h"

EditLokos::EditLokos(QWidget *parent) :
    QDialog(parent),
    ui(new Ui::EditLokos)
{
    ui->setupUi(this);

    // connect(ui->actionNou, SIGNAL(triggered()), this, SLOT(onNew()));


    QSettings settings;

    bool advanced = settings.value("editLokos/showAdvancedOptions", false).toBool();

    if (advanced)
    {
        ui->groupBox->show();
        ui->advanced->setChecked(true);
    }
    else
    {
        ui->groupBox->hide();
        ui->advanced->setChecked(false);
    }
}

void EditLokos::accept()
{
    saveSettings();

    QDialog::accept();
}

void EditLokos::FillTreeWidget(QMap<int,Loko*> lokosMap)
{
    int i=0;

    lokos = lokosMap;

    QTreeWidgetItem *motorola = new QTreeWidgetItem(ui->treeWidget);
    motorola->setText(0, "motorola");

    QTreeWidgetItem *mfx = new QTreeWidgetItem(ui->treeWidget);
    mfx->setText(0, "mfx");

    QTreeWidgetItem *dcc = new QTreeWidgetItem(ui->treeWidget);
    dcc->setText(0, "dcc");

    QMapIterator<int, Loko *> iter(lokos);

    while (iter.hasNext())
    {
        iter.next();

        Loko *loko = iter.value();

        if (loko->type == "motorola")
        {
            QTreeWidgetItem *lokoItem = new QTreeWidgetItem(motorola);
            lokoItem->setText(i++, loko->name);
        }
        else if (loko->type == "mfx")
        {
            QTreeWidgetItem *lokoItem = new QTreeWidgetItem(mfx);
            lokoItem->setText(i++, loko->name);
        }
        else if (loko->type == "dcc")
        {
            QTreeWidgetItem *lokoItem = new QTreeWidgetItem(dcc);
            lokoItem->setText(i++, loko->name);
        }

    }
}

void EditLokos::saveSettings()
{
    QSettings settings;
    settings.setValue("editLokos/showAdvancedOptions", ui->advanced->isChecked());
}

EditLokos::~EditLokos()
{
    delete ui;
}

